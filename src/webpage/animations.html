<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <title>Animations</title>
    </head>
    <body>
        <main>
        <h1> Sprite drawing and animation documentation: </h1>
        <section>
        This part of an engine works around 3 systems: DrawSystem, SkeletalSystem, StaticAnimationSystem;

        It is capable for creating:
        <ol>
            <li>Drawing not animated sprites</li>
            <li>Animations</li>
            <li>Skeleton body with bones and textures on each bone</li>
            <li>Skeleton animations (animating angle and texture)</li> 
        </ol>

        </section>
        <section>
            <h2>1. Drawing not animated sprites</h2>

            To create enitity that will be draw on canvas you need to preload sprite/image that your entity will use.

            <pre>
                function preload() {
                    return new Promise((resolve, reject) =&lt; {
                        asset = new Image();
                        asset.src = 'path to your asset';

                        asset.onload = () =&lt; {
                            resolve();
                        }
                    });
                }
            </pre>

            Then you want to create 'draw' component that will use three classes EcsComponent, Vector2d and Sprite.

            <pre>
                let sprite: Sprite = new Sprite(
                    asset,
                    40, // frame width,
                    40, // frame height,
                    10 // number of frames in a row
                );
                let drawComponent: EcsComponent = new EcsComponent('draw', 
                    {
                        position: new Vector2d(x, y), // position where entity will be draw,
                        destWidth: 40, // width ,
                        destHeight: 40, // height ,
                        sprite,
                    }
                );
            </pre>

            And then you just need to create entity that will use this component (more in source code for this demo page)
        </section>

        <section>
            <h2>2. Animations </h2>

            First you need to create draw component like in example above.

            Then we want to create animation component that will use TextureAnimationComponent class,

            <pre>
                let animationComponent = new EcsComponent('animation', 
                    new TextureAnimationComponent(
                        0, // from frame,
                        1, // to frame,
                        10, // frameRate,
                        true // will animation loop after end or it should end when passing last frame
                    )
                );
            </pre>

            After this we create entity with 2 components.

            <pre>
                let animatedEntity = new EcsEntity([ drawComponent, animationComponent ]);
            </pre>

        </section>

        <section>
            <h2>Skeleton body with bones and textures on each bone and animations</h2>

            <p>
                Skeleton body uses more complex skeleton component that is defined by 3 interfaces. 
                Please check ISkeletonComponent.ts file to get more knowlage about IBone, IJoinPoint 
                and ISkeletonComponent interfaces. To get more knowlage about skeleton animations see:
                IAnimationComponent.ts
            </p>

            In example we will create simple skeleton with: 
            - 3 join points, 
            - 2 bones (with texture on each bone),
            - 2 animations (walk - animates 2 bones, attack - animates only one bone),

            !Attention -> animation will be played only if is in state: ANIMATION_STATES.PLAYING

            <pre> 
                let skeletalComponent = new EcsComponent('skeleton',
                    {
                        joinPoints: [
                            {
                                id: 1,
                                position: new Vector2d(200, 100),
                                childJoinPoints: [2],
                            },
                            {
                                id: 2,
                                position: new Vector2d(220, 100),
                                parentJoinPoint: 1,
                                childJoinPoints: [3]
                            },
                            {
                                id: 3,
                                position: new Vector2d(240, 140),
                                parentJoinPoint: 2
                            }
                        ],
                        bones: [
                            {
                                id: 1,
                                parentJoinPointId: 1,
                                childJoinPointId: 2,
                                texture: {
                                    sprite: new Sprite(images.legs, 40, 56, 1),
                                    offsetX: 0,
                                    offsetY: 0,
                                    currentFrame: 4
                                }
                            },
                            {
                                id: 2,
                                parentJoinPointId: 2,
                                childJoinPointId: 3,
                                texture: {
                                    sprite: new Sprite(images.body, 40, 56, 1),
                                    offsetX: -20,
                                    offsetY: 0,
                                    currentFrame: 6
                                }
                            }
                        ],
                        animations: [
                            {
                                id: 0,
                                name: 'walk',
                                state: ANIMATION_STATES.PLAYING,
                                stepIndex: 0,
                                loop: true,
                                steps: [
                                    [
                                        new BoneTextureAnimationComponent(4, 8, 10, 1), 
                                        new BoneTextureAnimationComponent(4, 8, 10, 2),
                                        // new AngleAnimationComponent(0, 360, 120, 1), 
                                    ],
                                ]
                            },
                            {
                                id: 1,
                                name: 'attack',
                                state: ANIMATION_STATES.PLAYING,
                                stepIndex: 0,
                                loop: true,
                                steps: [
                                    [
                                        new BoneTextureAnimationComponent(0, 4, 10, 2),
                                    ]
                                ]
                            }
                        ]
                    }
                );
            </pre>
        </section>
        </main>
    </body>
</html>
